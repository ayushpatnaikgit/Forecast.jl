<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>London Weather/Crime (Multivariate) · Forecast.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Forecast.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Forecast.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">What is this about?</a></li><li><a class="tocitem" href="../../quickstart/">Quick Start</a></li><li><span class="tocitem">Forecast Examples</span><ul><li><a class="tocitem" href="../quakes/">Quakes (Univariate)</a></li><li><a class="tocitem" href="../airpassengers/">Air Passengers (Seasonality)</a></li><li class="is-active"><a class="tocitem" href>London Weather/Crime (Multivariate)</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Descriptive-Analysis"><span>Descriptive Analysis</span></a></li><li><a class="tocitem" href="#Fitting-an-AR(1)-model"><span>Fitting an AR(1) model</span></a></li><li><a class="tocitem" href="#Fixing-Coefficients"><span>Fixing Coefficients</span></a></li><li><a class="tocitem" href="#Transformed-Forecasting"><span>Transformed Forecasting</span></a></li></ul></li><li><a class="tocitem" href="../whatif/">WHAT-IF Scenarios</a></li></ul></li><li><a class="tocitem" href="../../methods/">Featured Methods</a></li><li><a class="tocitem" href="../../datasets/">Datasets</a></li><li><a class="tocitem" href="../../docstrings/">Docstrings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Forecast Examples</a></li><li class="is-active"><a href>London Weather/Crime (Multivariate)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>London Weather/Crime (Multivariate)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/viraltux/Forecast.jl/blob/master/docs/src/man/examples/london.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="London-Weather/Crime-(Multivariate)"><a class="docs-heading-anchor" href="#London-Weather/Crime-(Multivariate)">London Weather/Crime (Multivariate)</a><a id="London-Weather/Crime-(Multivariate)-1"></a><a class="docs-heading-anchor-permalink" href="#London-Weather/Crime-(Multivariate)" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>In this example we will study the relationship between weather and crime in in Greater London. In particular we will be considering ten years of monthly data about weather and crime in Greater London from 2008 to 2018.</p><pre><code class="language-">x = london()
plot(x)</code></pre><p>The variables at play will be:</p><ul><li><strong>MaxTemp</strong>:  Monthly data for the mean daily maximum temperature in C° for each month.</li><li><strong>Violence</strong>: Violent crimes comprising; Assault with Injury, Common Assault, Grievous Bodily Harm, Harassment, Murder, Offensive Weapon, Other violence, Wounding/GBH</li><li><strong>Sexual</strong>: Rape, Other sexual crimes.</li></ul><h2 id="Descriptive-Analysis"><a class="docs-heading-anchor" href="#Descriptive-Analysis">Descriptive Analysis</a><a id="Descriptive-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Descriptive-Analysis" title="Permalink"></a></h2><h3 id="Seasonality"><a class="docs-heading-anchor" href="#Seasonality">Seasonality</a><a id="Seasonality-1"></a><a class="docs-heading-anchor-permalink" href="#Seasonality" title="Permalink"></a></h3><pre><code class="language-">splot(x[:,[&quot;Date&quot;,&quot;MaxTemp&quot;]], title=&quot;Seasonal Maximum Temperature&quot;)</code></pre><pre><code class="language-">splot(x[:,[&quot;Date&quot;,&quot;Violence&quot;]], title=&quot;Seasonal Violent Crimes&quot;)</code></pre><pre><code class="language-">splot(x[:,[&quot;Date&quot;,&quot;Sexual&quot;]], title=&quot;Seasonal Sexual Crimes&quot;)</code></pre><p>Sesonality patterns for <code>MaxTemp</code> are obvious and noticeable for <code>Violence</code>, however there&#39;s barely any to be seen in <code>Sexual</code>.</p><h3 id="Normalization"><a class="docs-heading-anchor" href="#Normalization">Normalization</a><a id="Normalization-1"></a><a class="docs-heading-anchor-permalink" href="#Normalization" title="Permalink"></a></h3><p>To compare time series with different positive magnitudes and to facilitate an stationary forecasting we will normalize data by dividing each variable by its maximum value.</p><pre><code class="language-">tx = copy(x)
tx[!,2:end] = Array(x[:,2:end]) ./   (1. * mapslices(maximum, Array(x[:,2:end]), dims=[1]))
tx = tx[:,[&quot;Date&quot;,&quot;MaxTemp&quot;,&quot;Violence&quot;,&quot;Sexual&quot;]]
# hide</code></pre><p>To achieve an stationary time series to start our analysis we need to differentiate <code>MaxTemp</code> with a lag of 12, however this might not be enough for <code>Violence</code> and <code>Sexual</code> since they also show a marked trend from 2013 onwards.</p><pre><code class="language-">dtx = d(tx,1,12) 
plot(dtx)</code></pre><p>An extra differentation might be required for <code>Violence</code> and <code>Sexual</code> but this seems to be one to many for <code>MaxTemp</code> indicated by an increase in its variance when doing so. Also, the apparent need for a differentation in <code>Violence</code> and <code>Sexual</code> seems to be a temporary effect rather than a permanent trend or seasonality therefore we will continue with just one differentation of order 12.</p><h2 id="Fitting-an-AR(1)-model"><a class="docs-heading-anchor" href="#Fitting-an-AR(1)-model">Fitting an AR(1) model</a><a id="Fitting-an-AR(1)-model-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-an-AR(1)-model" title="Permalink"></a></h2><p>Given the scarcity of data for a multivariate model we cannot fit too many parameters while keeping its significance. We will therefore fit an AR of order one.</p><pre><code class="language-">xar = ar(dtx,1,false)
show(xar) # hide</code></pre><p>The first thing we can do is to use Φ1 to infer directional causality, in this case we see how <code>MaxTemp</code> is not influenced at all (with statistical significance) by <code>Violence</code> and <code>Sexual</code>, which could not possibly be otherwise in this case. On the other hand we have <code>Violence</code> and <code>Sexual</code> being affected significantly by <code>MaxTemp</code>.</p><p>The relathionship between <code>Violence</code> and <code>Sexual</code> is both ways, however, the effect <code>Sexual</code> has on <code>Violence</code> is small and barely significant which might prompt us to consider to remove it altogether, the opposite though is not true, <code>Violence</code> has a strong and significant influence in <code>Sexual</code>.</p><h2 id="Fixing-Coefficients"><a class="docs-heading-anchor" href="#Fixing-Coefficients">Fixing Coefficients</a><a id="Fixing-Coefficients-1"></a><a class="docs-heading-anchor-permalink" href="#Fixing-Coefficients" title="Permalink"></a></h2><p>Let&#39;s now fix to 0 the influcence of <code>Violence</code> and <code>Sexual</code> on <code>MaxTemp</code>, remove the influence from <code>MaxTemp</code> on <code>Sexual</code> since it is accounted for via <code>Violence</code> and the non-significant influence of <code>Sexual</code> on <code>Violence</code>. If now we fit again the model we have</p><pre><code class="language-">dϕ1 = xar.Φ
dϕ2 = copy(dϕ1)
dϕ2[1,2:3,1] .= 0.0
dϕ2[3,1,1] = 0.0
dϕ2[2,3,1] = 0.0
dΦ = (dϕ1, dϕ2)
fxar = ar(dtx,1,false; dΦ)
show(fxar) # hide</code></pre><h2 id="Transformed-Forecasting"><a class="docs-heading-anchor" href="#Transformed-Forecasting">Transformed Forecasting</a><a id="Transformed-Forecasting-1"></a><a class="docs-heading-anchor-permalink" href="#Transformed-Forecasting" title="Permalink"></a></h2><p>Next we can see the two years forecast for the transformed dataset.</p><pre><code class="language-">dtfc = forecast(fxar,12*2)
plot(dtfc)</code></pre><p>In order to obtain a forecast for the original data we need to invert the transformations carried out previously.</p><h3 id="Scaled-Forecasting"><a class="docs-heading-anchor" href="#Scaled-Forecasting">Scaled Forecasting</a><a id="Scaled-Forecasting-1"></a><a class="docs-heading-anchor-permalink" href="#Scaled-Forecasting" title="Permalink"></a></h3><p>Next we can see the two years forecast for the scaled dataset.</p><pre><code class="language-">x0 = Array(tx[1:12,2:end])
x0 = reshape(x0&#39;,1,3,12)
tfc = p(dtfc, x0)
setnames!(tfc,[&quot;MaxTemp / $(maximum(x.MaxTemp))&quot;,
               &quot;Violence / $(maximum(x.Violence))&quot;,
               &quot;Sexual / $(maximum(x.Sexual))&quot;])
plot(tfc,title=&quot;Greater London Crime/Weather Scaled Forecast&quot;)</code></pre><p>The two years forecast follows:</p><h3 id="Final-Forecast"><a class="docs-heading-anchor" href="#Final-Forecast">Final Forecast</a><a id="Final-Forecast-1"></a><a class="docs-heading-anchor-permalink" href="#Final-Forecast" title="Permalink"></a></h3><pre><code class="language-">fc = transform(tfc,(v-&gt;v*maximum(x.MaxTemp)),1);
fc = transform(fc,(v-&gt;round(v*maximum(x.Violence))),2)
fc = transform(fc,(v-&gt;round(v*maximum(x.Sexual))),3)
setnames!(fc,[&quot;MaxTemp&quot;,&quot;Violence&quot;,&quot;Sexual&quot;])

fc.mean</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../airpassengers/">« Air Passengers (Seasonality)</a><a class="docs-footer-nextpage" href="../whatif/">WHAT-IF Scenarios »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 9 September 2021 14:52">Thursday 9 September 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
