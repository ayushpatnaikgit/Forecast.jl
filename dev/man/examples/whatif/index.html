<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>WHAT-IF Scenarios · Forecast.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Forecast.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Forecast.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">What is this about?</a></li><li><a class="tocitem" href="../../quickstart/">Quick Start</a></li><li><span class="tocitem">Forecast Examples</span><ul><li><a class="tocitem" href="../quakes/">Quakes (Univariate)</a></li><li><a class="tocitem" href="../airpassengers/">Air Passengers (Seasonality)</a></li><li><a class="tocitem" href="../london/">London Weather/Crime (Multivariate)</a></li><li class="is-active"><a class="tocitem" href>WHAT-IF Scenarios</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#London-Crime/Weather-Scenarios"><span>London Crime/Weather Scenarios</span></a></li><li><a class="tocitem" href="#Fitting-and-Forecast"><span>Fitting and Forecast</span></a></li><li><a class="tocitem" href="#Scenario-Building"><span>Scenario Building</span></a></li><li><a class="tocitem" href="#Forecasting-Scenario"><span>Forecasting Scenario</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../methods/">Featured Methods</a></li><li><a class="tocitem" href="../../datasets/">Datasets</a></li><li><a class="tocitem" href="../../docstrings/">Docstrings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Forecast Examples</a></li><li class="is-active"><a href>WHAT-IF Scenarios</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>WHAT-IF Scenarios</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/viraltux/Forecast.jl/blob/master/docs/src/man/examples/whatif.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="WHAT-IF-Scenarios"><a class="docs-heading-anchor" href="#WHAT-IF-Scenarios">WHAT-IF Scenarios</a><a id="WHAT-IF-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#WHAT-IF-Scenarios" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>There are situations in multivariate analysis in which we want to know things like:</p><ul><li>How robust is our model to impacts</li><li>How does our model evolves given known events</li><li>How does overall accuracy improves if we improve forecast accuracy for specific variables</li><li>How does our model reacts to different scenarios</li></ul><p>To answer this questions and similar ones we need a way to instruct our forecast to test this scenarios.</p><h2 id="London-Crime/Weather-Scenarios"><a class="docs-heading-anchor" href="#London-Crime/Weather-Scenarios">London Crime/Weather Scenarios</a><a id="London-Crime/Weather-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#London-Crime/Weather-Scenarios" title="Permalink"></a></h2><p>Let&#39;s show how to use the Great London Crime/Weather example. In this example we see how weather temperature affects/explains criminality in Greater London. However, the prediction of temperature is not as accurate as it would be if we use forecast coming from (metoffice)[metoffice.gov.uk] instead those predicted by an AR(1) model. Therefore in order to have more accurate predictions about crime we want to overrule the temperature forecast of the AR(1) model with the forecast comming from <code>metoffice</code>.</p><p>These metoffice predictions would not be much different than those from the AR(1) model therefore, in order to better visualize impacts in the forecast, we will play with an hypothetical scenario in which temperatures increase one degree per month for two years straight.</p><p>Also, let&#39;s imagine that the accuracy of the one degree per year scenario is much better than the one coming for the AR(1) model making its variance 25 times smaller.</p><h2 id="Fitting-and-Forecast"><a class="docs-heading-anchor" href="#Fitting-and-Forecast">Fitting and Forecast</a><a id="Fitting-and-Forecast-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-and-Forecast" title="Permalink"></a></h2><p>Let&#39;s first fit our model and retrieve its forecast. We will be using the scaled forecast to better see how our changes affect the model.</p><pre><code class="language-">x = london()
tx = copy(x)
tx[!,2:end] = Array(x[:,2:end]) ./   (1. * mapslices(maximum, Array(x[:,2:end]), dims=[1]))
tx = tx[:,[&quot;Date&quot;,&quot;MaxTemp&quot;,&quot;Violence&quot;,&quot;Sexual&quot;]]

dtx = d(tx,1,12) 

xar = ar(dtx,1,false)

dϕ1 = xar.Φ
dϕ2 = copy(dϕ1)
dϕ2[1,2:3,1] .= 0.0
dϕ2[3,1,1] = 0.0
dϕ2[2,3,1] = 0.0
dΦ = (dϕ1, dϕ2)
fxar = ar(dtx,1,false; dΦ)

dtfc = forecast(fxar,12*2)

x0 = Array(tx[1:12,2:end])
x0 = reshape(x0&#39;,1,3,12)
tfc = p(dtfc, x0)
setnames!(tfc,[&quot;MaxTemp / $(maximum(x.MaxTemp))&quot;,
               &quot;Violence / $(maximum(x.Violence))&quot;,
               &quot;Sexual / $(maximum(x.Sexual))&quot;])

plot(tfc,title=&quot;Greater London Crime/Weather Scaled Forecast&quot;)</code></pre><h2 id="Scenario-Building"><a class="docs-heading-anchor" href="#Scenario-Building">Scenario Building</a><a id="Scenario-Building-1"></a><a class="docs-heading-anchor-permalink" href="#Scenario-Building" title="Permalink"></a></h2><p>The last forecast we ran is for <code>tfc</code>, therefore we need to transform as well our what-if scenario to be able to use it.</p><pre><code class="language-"># Scenario: starting at 10 C° and increasing one degree per month for two years
witemp = vcat(x.MaxTemp, 10 .+ collect(1:2*12)) 
witemp = witemp ./ maximum(x.MaxTemp) 
witemp = d(witemp,1,12)[end-12*2+1:end]
# hide</code></pre><p>Now we create a DataFrame with the values we want to fix in our scenario</p><pre><code class="language-">fixMean = copy(tfc.mean)
fixMean[!,3:4] .= missing
fixMean[!,2] = witemp
# hide</code></pre><p>We also fix the Variance matrix with a 25 times smaller variance for <code>MaxTemp</code> and update accordingly its covariance interactions.</p><pre><code class="language-">fixΣ2  = copy(dtfc.model.Σ2)
fixΣ2[1,:] = fixΣ2[1,:]./5
fixΣ2[:,1] = fixΣ2[:,1]./5
# hide</code></pre><h2 id="Forecasting-Scenario"><a class="docs-heading-anchor" href="#Forecasting-Scenario">Forecasting Scenario</a><a id="Forecasting-Scenario-1"></a><a class="docs-heading-anchor-permalink" href="#Forecasting-Scenario" title="Permalink"></a></h2><p>Finally we forecast the <code>fxar</code> model with the scenario built previously.</p><pre><code class="language-">dtfc = forecast(fxar,12*2; fixMean, fixΣ2)
plot(dtfc,title=&quot;Greater London Crime/Weather Scaled Forecast &amp; Fixed MaxTemp&quot;)
            
x0 = Array(tx[1:12,2:end])
x0 = reshape(x0&#39;,1,3,12)
tfc0 = p(dtfc)
tfc = p(dtfc, x0)


setnames!(tfc,[&quot;Fixed MaxTemp / $(maximum(x.MaxTemp))&quot;,
               &quot;Violence / $(maximum(x.Violence))&quot;,
               &quot;Sexual / $(maximum(x.Sexual))&quot;])

plot(tfc,title=&quot;Greater London Crime/Weather Scaled Forecast &amp; Fixed MaxTemp&quot;)</code></pre><p>We can see how our scenario displays a much narrower forecast interval, however the new scenario in the already small covariance does not affect much the intervals for crime.</p><p>Another noticeable effect would be the inverse relationship between crime and temperature, this is something we can see directly into the AR(1) coefficients but now we can clearly visualize it.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../london/">« London Weather/Crime (Multivariate)</a><a class="docs-footer-nextpage" href="../../methods/">Featured Methods »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 9 September 2021 14:54">Thursday 9 September 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
